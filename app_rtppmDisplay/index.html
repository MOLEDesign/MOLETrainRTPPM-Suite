<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="initial-scale=1.0, user-scalable=no">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
	<meta http-equiv="refresh" content="300">
	<title>UK PPM Viewer</title>
	<link rel="stylesheet" href="http://code.jquery.com/mobile/1.2.0/jquery.mobile-1.2.0.min.css" />
	<link rel="stylesheet" href="my.css" />
	<link rel="stylesheet" href="table.css" />
	<script src="http://code.jquery.com/jquery-1.7.2.min.js"></script>
	<script src="http://code.jquery.com/mobile/1.2.0/jquery.mobile-1.2.0.min.js"></script>
	<script src="my.js"></script>

  <!-- User-generated css -->
  <style>
    
  </style>

  <!-- User-generated js -->
  <script>

    $(function() {
        
    });

  </script>
</head>
<body>
  <!-- Home -->
  <div data-role="page" id="page1">
      <div data-theme="a" data-role="header">
          <h3>
            <div id="headerplaceholder"></div>
            <script>
                $.getJSON('http://development.moledesign.biz/node/output.json', function (data) {
					var myDate = new Date( data.RTPPMDataMsgV1.timestamp * 1000);
					var properDate = myDate.toLocaleString();
                    var output = 'RT-PPM (';
                    output += properDate;
                    output += ')';
                    document.getElementById("headerplaceholder").innerHTML = output;
                });						
            </script>
          </h3>
      </div>
      <div data-role="content">
          <div data-role="collapsible-set" data-theme="b">
              <div data-role="collapsible">
                  <h3>
                  National
                  </h3>
                  <div>

						<div id="placeholder"></div>
						<script>
							$.getJSON('http://development.moledesign.biz/node/output.json', function (data) {
								var output = '<table cellspacing="0" width="99%">';
									output += '<thead>';
									output += '<tr>';
									output += '<th>Sector</th>';
									output += '<th>PPM</th>';
									output += '<th>PPM (2 hours)</th>';
									output += '</th>';
									output += '</thead>';
									
									output += '</tbody>';
									output += '<tr style="font-weight:bold;">';
									output += '<td>National</td>';
									output += '<td>' + data.RTPPMDataMsgV1.RTPPMData.NationalPage.NationalPPM.PPM.text + '</td>';
									output += '<td>' + data.RTPPMDataMsgV1.RTPPMData.NationalPage.NationalPPM.RollingPPM.text + '</td>';
									output += '</tr>';

									for (var i in data.RTPPMDataMsgV1.RTPPMData.NationalPage.Sector) {
										output += "<tr>";
										output += "<td>" + data.RTPPMDataMsgV1.RTPPMData.NationalPage.Sector[i].sectorDesc + "</td>";
										output += "<td>" + data.RTPPMDataMsgV1.RTPPMData.NationalPage.Sector[i].SectorPPM.PPM.text + "</td>";
										output += "<td>" + data.RTPPMDataMsgV1.RTPPMData.NationalPage.Sector[i].SectorPPM.RollingPPM.text + "</td>";
										output += "</tr>";
								}
								output += "</tbody>";
								output += "</table>";
								document.getElementById("placeholder").innerHTML = output;
							});						
						</script>

                  </div>
              </div>
              <div data-role="collapsible">
                        <h3>
                            All UK PPM Data
                        </h3>
						<div id="placeholder2"></div>
						<script>
							$.getJSON('http://development.moledesign.biz/node/output.json', function (data) {
								var output = '<table cellspacing="0" width="99%">';
									output += "<thead>";
									output += "<tr>";
									output += "<th>Operator</th>";
									output += "<th>PPM</th>";
									output += "<th>PPM (2 hours)</th>";
									output += "</tr>";
									output += "</thead>";
									output += "<tbody>";

								for (var i in data.RTPPMDataMsgV1.RTPPMData.NationalPage.Operator) {
									output += "<tr>";
									output += "<td>" + data.RTPPMDataMsgV1.RTPPMData.NationalPage.Operator[i].name + "</td>";
									output += "<td>" + data.RTPPMDataMsgV1.RTPPMData.NationalPage.Operator[i].PPM.text + "</td>";
									output += "<td>" + data.RTPPMDataMsgV1.RTPPMData.NationalPage.Operator[i].RollingPPM.text + "</td>";
									output += "</tr>";
								}
								output += "</tbody>";
								output += "</table>";
								document.getElementById("placeholder2").innerHTML = output;
							});						
						</script>
                    </div>
                    <div data-role="collapsible">
                  <h3>
                      First Great Western
                  </h3>
                  <div>

						<div id="placeholder3"></div>
						<script>
							$.getJSON('http://development.moledesign.biz/node/output.json', function (data) {
								var output = '<table cellspacing="0" width="99%">';
									output += "<thead>";
									output += "<tr>";
									output += "<th>Area</th>";
									output += "<th>PPM</th>";
									output += "<th>PPM (2 hours)</th>";
									output += "</tr>";
									output += "</thead>";
									output += "<tbody>";

								for (var i in data.RTPPMDataMsgV1.RTPPMData.OperatorPage) {
									if (data.RTPPMDataMsgV1.RTPPMData.OperatorPage[i].Operator.code == 25) {
										var currentcode = i;
										for (var j in data.RTPPMDataMsgV1.RTPPMData.OperatorPage[currentcode].OprServiceGrp) {
											output += "<tr>";
											output += "<td>" + data.RTPPMDataMsgV1.RTPPMData.OperatorPage[currentcode].OprServiceGrp[j].name + "</td>";
											output += "<td>" + data.RTPPMDataMsgV1.RTPPMData.OperatorPage[currentcode].OprServiceGrp[j].PPM.text + "</td>";
											output += "<td>" + data.RTPPMDataMsgV1.RTPPMData.OperatorPage[currentcode].OprServiceGrp[j].RollingPPM.text + "</td>";
											output += "</tr>";
										}
									}
								}
								output += "</tbody>";
								output += "</table>";
								document.getElementById("placeholder3").innerHTML = output;
							});						
						</script>

                  </div>
              </div>
              <div data-role="collapsible">
                  <h3>
                      Custom View
                  </h3>
                  <form action="">
                      <div data-role="fieldcontain" id="opcode">
							<script>
								$.getJSON('http://development.moledesign.biz/node/output.json', function (data) {
									var output = '<select id="opcode" name="choose_operator">';
										
									for (var i in data.RTPPMDataMsgV1.RTPPMData.NationalPage.Operator) {
										output += '<option value="';
										output += data.RTPPMDataMsgV1.RTPPMData.NationalPage.Operator[i].code;
										output += '">';
										output += data.RTPPMDataMsgV1.RTPPMData.NationalPage.Operator[i].name;
										output += '</option>';
									}							
									output += '</select>';
									document.getElementById("opcode").innerHTML = output;
																});						

									</script>
                      </div>
                  </form>
				  <div>
						<div id="placeholder4"></div>
						<script>
							$.getJSON('http://development.moledesign.biz/node/output.json', function (data) {
								var output = '<table cellspacing="0" width="99%">';
									output += "<thead>";
									output += "<tr>";
									output += "<th>Area</th>";
									output += "<th>PPM</th>";
									output += "<th>PPM (2 hours)</th>";
									output += "</tr>";
									output += "</thead>";
									output += "<tbody>";

								for (var i in data.RTPPMDataMsgV1.RTPPMData.OperatorPage) {
									if (data.RTPPMDataMsgV1.RTPPMData.OperatorPage[i].Operator.code == 25) {
										var currentcode = i;
										for (var j in data.RTPPMDataMsgV1.RTPPMData.OperatorPage[currentcode].OprServiceGrp) {
											output += "<tr>";
											output += "<td>" + data.RTPPMDataMsgV1.RTPPMData.OperatorPage[currentcode].OprServiceGrp[j].name + "</td>";
											output += "<td>" + data.RTPPMDataMsgV1.RTPPMData.OperatorPage[currentcode].OprServiceGrp[j].PPM.text + "</td>";
											output += "<td>" + data.RTPPMDataMsgV1.RTPPMData.OperatorPage[currentcode].OprServiceGrp[j].RollingPPM.text + "</td>";
											output += "</tr>";
										}
									}
								}
								output += "</tbody>";
								output += "</table>";
								document.getElementById("placeholder4").innerHTML = output;
							});						
						</script>

				  </div>
              </div>
          </div>
      </div>
      <div data-role="tabbar" data-iconpos="top" data-theme="b">
          <ul>
              <li>
                  <a href="#page1" data-transition="turn" data-theme="" data-icon="home">
                      Home
                  </a>
              </li>
              <li>
                  <a href="#page2" data-transition="turn" data-theme="" data-icon="grid">
                      Help
                  </a>
              </li>
              <li>
                  <a href="#page4" data-transition="turn" data-theme="" data-icon="info">
                      Info
                  </a>
              </li>
          </ul>
      </div>
  </div>
  <!-- Help -->
  <div data-role="page" id="page2">
      <div data-theme="a" data-role="header">
          <h3>
              HELP &amp; DOCS
          </h3>
      </div>
      <div data-role="content">
          <div>
              <p>
                  <b>
                      Documentation to follow
                  </b>
              </p>
          </div>
      </div>
      <div data-role="tabbar" data-iconpos="top" data-theme="b">
          <ul>
              <li>
                  <a href="#page1" data-transition="turn" data-theme="" data-icon="home">
                      Home
                  </a>
              </li>
              <li>
                  <a href="#page2" data-transition="turn" data-theme="" data-icon="grid">
                      Help
                  </a>
              </li>
              <li>
                  <a href="#page4" data-transition="turn" data-theme="" data-icon="info">
                      Info
                  </a>
              </li>
          </ul>
      </div>
  </div>
  <!-- Info -->
  <div data-role="page" id="page3">
      <div data-theme="a" data-role="header">
          <h3>
              INFO
          </h3>
      </div>
      <div data-role="content">
          <h2>
              FGW PPM Datafeed
          </h2>
          <h2>
              Version 1.0.0
          </h2>
          <div>
              <p>
                  <b>
                      This application is based on open source code, with data from National
                      Rail.
                  </b>
              </p>
              <p>
                  <b>
                      No responsibility can be taken for innaccurate data supplied by Nation
                      rail.
                  </b>
              </p>
              <p>
                  <b>
                      Please report any problems with this application to
                  </b>
              </p>
              <p>
                  <a data-mce-href="mailto:fgw-it@firstgroup.com" href="mailto:fgw-it@firstgroup.com"
                  style="">
                      <b>
                          fgw-it@firstgroup.com
                      </b>
                  </a>
              </p>
          </div>
      </div>
      <div data-role="tabbar" data-iconpos="top" data-theme="b">
          <ul>
              <li>
                  <a href="#page1" data-transition="turn" data-theme="" data-icon="home">
                      Home
                  </a>
              </li>
              <li>
                  <a href="#page2" data-transition="turn" data-theme="" data-icon="grid">
                      Help
                  </a>
              </li>
              <li>
                  <a href="#page3" data-transition="turn" data-theme="" data-icon="info">
					Info
                  </a>
              </li>
              <li>
                  <a href="#page1" data-transition="turn" data-theme="" data-icon="home">
                      Refresh
                  </a>
              </li>
          </ul>
      </div>
  </div>

  
</body>
</html>
